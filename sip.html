<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Cardle</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 900px; margin: auto; }
    input { padding: 8px; margin: 5px; width: 200px; }
    button { padding: 8px 12px; }

    #immagineAuto {
      display: block;
      margin: 20px auto;
      max-width: 400px;
      border-radius: 10px;
      box-shadow: 0 0 10px #aaa;
    }

    .intestazione, .result-row {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }

    .cell, .header-cell {
      flex: 1; padding: 8px; margin: 2px;
      text-align: center;
      border-radius: 5px;
    }

    .header-cell {
      background-color: #444; color: #fff; font-weight: bold;
    }

    .cell { background-color: #ccc; color: #fff; }
    .correct { background-color: green; }
    .arrow { margin-left: 5px; }
  </style>
</head>
<body>
  <h1>Cardle - Indovina l'auto</h1>

  <img id="immagineAuto" src="" alt="Immagine auto segreta" />

  <div>
    <input list="marche" id="inputMarca" placeholder="Marca">
    <input list="modelli" id="inputModello" placeholder="Modello">
    <button onclick="provaTentativo()">Indovina</button>
  </div>
  <datalist id="marche"></datalist>
  <datalist id="modelli"></datalist>

  <div id="tentativi">
    <div class="intestazione">
      <div class="header-cell">Marca</div>
      <div class="header-cell">Modello</div>
      <div class="header-cell">Tipo</div>
      <div class="header-cell">Anno</div>
      <div class="header-cell">Nazionalità</div>
      <div class="header-cell">Cavalli</div>
    </div>
  </div>

  <script>
    const txtURL = 'https://raw.githubusercontent.com/Leoknight22/Cardle/refs/heads/main/database2425.txt';
    let database = [];
    let risposta = null;

    fetch(txtURL)
      .then(res => res.ok ? res.text() : Promise.reject("Errore nel caricamento"))
      .then(text => {
        const righe = text.split(';').filter(r => r.trim() !== '');
        const marcheSet = new Set();

        database = righe.map(riga => {
          const [marca, modello, tipo, anno, nazionalità, cavalli, link] = riga.split(',').map(e => e.trim());
          marcheSet.add(marca);
          return {
            marca, modello, tipo,
            anno: parseInt(anno),
            nazionalità, cavalli: parseInt(cavalli),
            link
          };
        });

        const inputMarca = document.getElementById('inputMarca');
        const datalistMarche = document.getElementById('marche');
        const datalistModelli = document.getElementById('modelli');

        // Marche
        datalistMarche.innerHTML = [...marcheSet].map(m => `<option value="${m}">`).join('');

        // Filtra modelli in base alla marca
        inputMarca.addEventListener('input', () => {
          const marcaInserita = inputMarca.value.toLowerCase();
          const modelliFiltrati = database
            .filter(auto => auto.marca.toLowerCase() === marcaInserita)
            .map(auto => auto.modello);
          const unici = [...new Set(modelliFiltrati)];
          datalistModelli.innerHTML = unici.map(m => `<option value="${m}">`).join('');
        });

        // Auto da indovinare
        risposta = database[Math.floor(Math.random() * database.length)];
        console.log("Auto da indovinare:", risposta);
        document.getElementById('immagineAuto').src = risposta.link;
      });

    function provaTentativo() {
      const marca = document.getElementById('inputMarca').value.trim();
      const modello = document.getElementById('inputModello').value.trim();
      const trovato = database.find(auto =>
        auto.marca.toLowerCase() === marca.toLowerCase() &&
        auto.modello.toLowerCase() === modello.toLowerCase()
      );

      if (!trovato) {
        alert("Modello non trovato nel database.");
        return;
      }

      mostraTentativo(trovato);
      document.getElementById('inputModello').value = '';
    }

    function mostraTentativo(auto) {
      const container = document.getElementById('tentativi');
      const div = document.createElement('div');
      div.className = 'result-row';

      div.appendChild(creaCella(auto.marca, auto.marca === risposta.marca));
      div.appendChild(creaCella(auto.modello, auto.modello === risposta.modello));
      div.appendChild(creaCella(auto.tipo, auto.tipo === risposta.tipo));
      div.appendChild(creaCella(auto.anno, auto.anno === risposta.anno, 'anno'));
      div.appendChild(creaCella(auto.nazionalità, auto.nazionalità === risposta.nazionalità));
      div.appendChild(creaCella(auto.cavalli, auto.cavalli === risposta.cavalli, 'cavalli'));

      container.appendChild(div);
    }

    function creaCella(valore, corretto, tipo = '') {
      const cella = document.createElement('div');
      cella.className = 'cell' + (corretto ? ' correct' : '');
      cella.textContent = valore;

      if (!corretto && (tipo === 'anno' || tipo === 'cavalli')) {
        const freccia = document.createElement('span');
        freccia.className = 'arrow';
        freccia.textContent = (valore < risposta[tipo]) ? '↑' : '↓';
        cella.appendChild(freccia);
      }

      return cella;
    }
  </script>
</body>
</html>
